<form class="input-container" [formGroup]="this.messageData" (ngSubmit)="onSubmit()">
  <textarea [placeholder]="'Nachricht an ' + this.chatService.placeholderName" formControlName="message"></textarea>
  <!--tagged User start-->
  @if (this.taggedUser) {
  <div class="tagged-user-container">
    @for (taggedUser of this.taggedUser; track taggedUser; let index = $index) {
    <span (click)="deleteTaggedUser(index)" class="pointer">{{'@' +
      this.firebaseService.getUserDisplayName(taggedUser)}}</span>
    }
  </div>
  }
  <!--tagged User end-->
  <div class="button-container">
    <div class="left-section">
        <!--storage preview start-->
		@if(this.storageDataUrl) {
			<div class="preview-container">
				<div (click)="this.closeAndDelete()" class="close-button pointer">X</div>
				<div class="image-preview">
					<img src="{{this.storageDataUrl}}" alt="">
				</div>
			</div>
		}
     <!--storage preview end-->
		<div class="add-data-container icon-container">
			<label for="fileUpload" class="button-white">
				<img class="pointer" src="assets/img/icons/add_grey.png" alt="icon-add" />
				<input type="file" accept=".jpg, .jpeg, .png, .pdf" id="fileUpload" (change)="uploadFile($event)" />
			</label>
		</div>
      <img class="" src="assets/img/icons/vertical_line_grey.png" alt="icon-vertical-line" />
      <div class="icon-container pointer" (click)="toggleEmojiPicker()">
        <img src="assets/img/icons/smiley_grey.png" alt="icon-smiley" />
      </div>
      <div class="icon-container pointer" (click)="toggleTagUser()">
        <img src="assets/img/icons/alternate_email_grey.png" alt="icon-email" />
      </div>
    </div>
    <div class="right-section">
      <button class="pointer" type="submit">
        <img src="assets/img/icons/send_dark_blue.png" alt="icon-send" />
      </button>
    </div>
  </div>
</form>

<!-- emoji Picker-->
@if (this.showEmojiPicker) {
<div class="emoji-picker-container">
  <emoji-mart (emojiClick)="addEmoji($event)"></emoji-mart>
</div>
}

<!--tag a channel Member-->
@if (this.showTagContainer && this.chatService.mainCollection == 'channels') {
<div class="tag-container">
  <div class="member-selection-wrapper">
    <div class="top-section">
      <div class="pointer close-btn" (click)="toggleTagUser()">
        <img src="assets/img/icons/close_black.png" alt="close-icon" />
      </div>
    </div>
    @for (channel of this.firebaseService.channelList; track channel; let channelIndex = $index) {
    @for (user of this.channel.members; track user; let index = $index) {
    @if (user !== this.firebaseService.currentUserId && this.channel.chanId === this.chatService.docRef &&
    !this.taggedUser.includes(user)) {
    <div class="member-container pointer" (click)="tagChannelMember(this.firebaseService.getUserDisplayName(user), user, channelIndex)">
      <div class="user-avatar">
        <img [src]="this.firebaseService.getUserAvatar(user)" alt="User Avatar" />
        <div class="user-status"
          [ngClass]="{ 'online': this.firebaseService.getUserOnlineStatus(user), 'offline': !this.firebaseService.getUserOnlineStatus(user) }">
        </div>
      </div>
      <span>{{ this.firebaseService.getUserDisplayName(user) }}</span>
    </div>
    }
    }
    }
  </div>
</div>
}


<!--tag a user-->
@if (this.communicationService.showAllUsers && this.showTagContainer && this.taggedUser.length +1  != this.firebaseService.userList.length) {
<div class="tag-container">
  <div class="member-selection-wrapper">
    <div class="top-section">
      <div class="pointer close-btn" (click)="toggleTagUser()">
        <img src="assets/img/icons/close_black.png" alt="close-icon" />
      </div>
    </div>
    @for (user of this.firebaseService.userList; track user; let index = $index) {
    @if (user.userId !== this.firebaseService.currentUserId && !this.taggedUser.includes(user.userId)) {
    <div class="member-container pointer" (click)="tagUser(user.name, user.userId)">
      <div class="user-avatar">
        <img [src]="this.firebaseService.getUserAvatar(user.userId)" alt="User Avatar" />
        <div class="user-status"
          [ngClass]="{ 'online': this.firebaseService.getUserOnlineStatus(user.userId), 'offline': !this.firebaseService.getUserOnlineStatus(user.userId) }">
        </div>
      </div>
      <span>{{ this.firebaseService.getUserDisplayName(user.userId) }}</span>
    </div>
    }
    }
  </div>
</div>
}

<!--tag a chat participant-->
@if (this.showTagContainer && this.chatService.mainCollection == 'privateChats') {
<div class="tag-container">
  <div class="member-selection-wrapper">
    <div class="top-section">
      <div class="pointer close-btn" (click)="toggleTagUser()">
        <img src="assets/img/icons/close_black.png" alt="close-icon" />
      </div>
    </div>
    @for (privateChat of this.firebaseService.privateChatList; track privateChat; let index = $index) {
    @if (privateChat.privatChatId === this.chatService.docRef && privateChat.chatReciver === this.firebaseService.currentUserId) {
    <div class="member-container pointer"
      (click)="tagChatUser(this.firebaseService.getUserDisplayName(privateChat.chatCreator), privateChat.chatCreator)">
      <div class="user-avatar">
        <img [src]="this.firebaseService.getUserAvatar(privateChat.chatCreator)" alt="User Avatar" />
        <div class="user-status"
          [ngClass]="{ 'online': this.firebaseService.getUserOnlineStatus(privateChat.chatCreator), 'offline': !this.firebaseService.getUserOnlineStatus(privateChat.chatCreator) }">
        </div>
      </div>
      <span>{{ this.firebaseService.getUserDisplayName(privateChat.chatCreator) }}</span>
    </div>
    @if (privateChat.chatCreator == this.firebaseService.currentUserId) {
    <div class="member-container pointer"
      (click)="tagChatUser(this.firebaseService.getUserDisplayName(privateChat.chatReciver), privateChat.chatReciver)">
      <div class="user-avatar">
        <img [src]="this.firebaseService.getUserAvatar(privateChat.chatReciver)" alt="User Avatar" />
        <div class="user-status"
          [ngClass]="{ 'online': this.firebaseService.getUserOnlineStatus(privateChat.chatReciver), 'offline': !this.firebaseService.getUserOnlineStatus(privateChat.chatReciver) }">
        </div>
      </div>
      <span>{{ this.firebaseService.getUserDisplayName(privateChat.chatReciver) }}</span>
    </div>
    }
    }
    }
  </div>
</div>
}